{% extends "base.html" %}

{% block title %}IP Locator - Network Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">IP Locator</h1>
    <p class="page-description">Find where an IP is advertised in the routing tables</p>
</div>

<!-- Search Form -->
<div class="md-card">
    <div class="card-content">
        <form method="get" class="search-form">
            <div class="search-row">
                <div class="search-input-wrapper">
                    <i data-lucide="search" class="search-icon"></i>
                    <input type="text"
                           name="ip"
                           class="search-input"
                           placeholder="Enter IP address (e.g., 10.1.1.1)"
                           value="{{ ip_address }}"
                           pattern="^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$"
                           autofocus>
                </div>
                <button type="submit" class="md-button">
                    <i data-lucide="radar" size="16"></i>
                    Locate
                </button>
            </div>
        </form>
    </div>
</div>

{% if error %}
<div class="md-card error-card" style="margin-top: 24px;">
    <div class="card-content">
        <div class="error-message">
            <i data-lucide="alert-circle" size="20"></i>
            <span>{{ error }}</span>
        </div>
    </div>
</div>
{% endif %}

{% if result %}
<!-- Routing Entries -->
<div class="md-card" style="margin-top: 24px;">
    <div class="card-header">
        <h2>
            <i data-lucide="route" size="18"></i>
            Routing Table Entries
            <span class="count-badge">{{ result.route_entries|length }}</span>
        </h2>
    </div>
    <div class="card-content">
        {% if result.route_entries %}
        <div class="md-table-container">
            <table class="md-table">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Prefix</th>
                        <th>Next Hop</th>
                        <th>Protocol</th>
                        <th>Interface</th>
                    </tr>
                </thead>
                <tbody>
                    {% for route in result.route_entries %}
                    <tr>
                        <td>
                            {% if route.device_id %}
                            <a href="/assets/devices/{{ route.device_id }}" class="link">{{ route.device_name }}</a>
                            {% else %}
                            {{ route.device_name }}
                            {% endif %}
                        </td>
                        <td><code>{{ route.prefix }}</code></td>
                        <td>
                            {% if route.next_hop == 'directly connected' %}
                            <span class="connected-badge">directly connected</span>
                            {% else %}
                            <code>{{ route.next_hop }}</code>
                            {% endif %}
                        </td>
                        <td>
                            <span class="protocol-badge protocol-{{ route.protocol|lower }}">{{ route.protocol }}</span>
                        </td>
                        <td>
                            {% if route.interface %}
                            <code>{{ route.interface }}</code>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state-small">
            <i data-lucide="search-x" size="24"></i>
            <p>No matching routes found</p>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% if not result and not error and not ip_address %}
<!-- Initial State -->
<div class="md-card" style="margin-top: 24px;">
    <div class="card-content">
        <div class="empty-state">
            <i data-lucide="route" size="48"></i>
            <h3>Enter an IP Address</h3>
            <p>Search routing tables to find where an IP is advertised across your network.</p>
        </div>
    </div>
</div>
{% endif %}

<style>
.search-form { width: 100%; }
.search-row { display: flex; gap: 16px; align-items: center; }
.search-input-wrapper { flex: 1; position: relative; }
.search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--md-on-surface-variant); width: 20px; height: 20px; }
.search-input { width: 100%; padding: 14px 16px 14px 48px; font-size: 16px; border: 1px solid var(--md-outline); border-radius: 12px; background: var(--md-surface-container); color: var(--md-on-surface); }
.search-input:focus { outline: none; border-color: var(--md-primary); box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.2); }
.md-button { display: flex; align-items: center; gap: 8px; padding: 14px 24px; background: var(--md-primary); color: var(--md-on-primary); border: none; border-radius: 12px; font-weight: 500; font-size: 14px; cursor: pointer; white-space: nowrap; }
.md-button:hover { opacity: 0.9; }
.count-badge { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; height: 24px; padding: 0 8px; background: var(--md-surface-container-high); border-radius: 12px; font-size: 12px; font-weight: 500; margin-left: 8px; }
code { font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; }
.connected-badge { color: var(--md-success, #22c55e); font-style: italic; }
.protocol-badge { padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
.protocol-connected { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
.protocol-static { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
.protocol-ospf { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
.protocol-bgp { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
.protocol-local { background: rgba(107, 114, 128, 0.2); color: #6b7280; }
.empty-state { text-align: center; padding: 48px 24px; color: var(--md-on-surface-variant); }
.empty-state i { color: var(--md-primary); margin-bottom: 16px; opacity: 0.7; }
.empty-state h3 { margin: 8px 0; color: var(--md-on-surface); }
.empty-state-small { text-align: center; padding: 24px 16px; color: var(--md-on-surface-variant); }
.empty-state-small i { opacity: 0.5; margin-bottom: 8px; }
.empty-state-small p { margin: 0; font-size: 13px; }
.error-card { border-left: 4px solid var(--md-error); }
.error-message { display: flex; align-items: center; gap: 12px; color: var(--md-error); }
.link { color: var(--md-primary); text-decoration: none; font-weight: 500; }
.link:hover { text-decoration: underline; }
.card-header h2 { display: flex; align-items: center; gap: 8px; }
.card-header h2 i { opacity: 0.7; }
</style>

<script>
lucide.createIcons();
</script>
{% endblock %}